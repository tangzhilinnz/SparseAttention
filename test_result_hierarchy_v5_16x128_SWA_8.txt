==================================================
<> Training Transformer Model (AMP Enabled)
==================================================
/home/ztang13/workspace/SparseAttention/myenv/lib/python3.12/site-packages/torch/optim/lr_scheduler.py:62: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.
  warnings.warn(
/home/ztang13/workspace/SparseAttention/Hierarchical_transformer_V5_WikiText2.py:708: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
Epoch 1/30:   0%|                                                                                                                                           | 0/1005 [00:00<?, ?it/s]/home/ztang13/workspace/SparseAttention/Hierarchical_transformer_V5_WikiText2.py:740: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
Epoch 1/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:32<00:00,  6.57it/s, loss=7.1389, ppl=1260.09]
<> Validating...
/home/ztang13/workspace/SparseAttention/Hierarchical_transformer_V5_WikiText2.py:791: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():

<> Epoch 1 Results:
<>  Time: 0:02:36
Train Loss: 7.5327 | Train PPL: 1868.23
Valid Loss: 6.8466 | Valid PPL: 940.66
<> Saved new best model with validation loss: 6.8466
Epoch 2/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:32<00:00,  6.57it/s, loss=6.8376, ppl=932.29]
<> Validating...

<> Epoch 2 Results:
<>  Time: 0:02:36
Train Loss: 6.9014 | Train PPL: 993.65
Valid Loss: 6.5401 | Valid PPL: 692.39
<> Saved new best model with validation loss: 6.5401
Epoch 3/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:33<00:00,  6.56it/s, loss=6.7021, ppl=814.13]
<> Validating...

<> Epoch 3 Results:
<>  Time: 0:02:36
Train Loss: 6.6581 | Train PPL: 779.07
Valid Loss: 6.3931 | Valid PPL: 597.71
<> Saved new best model with validation loss: 6.3931
Epoch 4/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:24<00:00,  6.96it/s, loss=6.6169, ppl=747.63]
<> Validating...

<> Epoch 4 Results:
<>  Time: 0:02:27
Train Loss: 6.4993 | Train PPL: 664.69
Valid Loss: 6.2946 | Valid PPL: 541.66
<> Saved new best model with validation loss: 6.2946
Epoch 5/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:06<00:00,  7.97it/s, loss=6.5374, ppl=690.50]
<> Validating...

<> Epoch 5 Results:
<>  Time: 0:02:09
Train Loss: 6.3694 | Train PPL: 583.68
Valid Loss: 6.2020 | Valid PPL: 493.74
<> Saved new best model with validation loss: 6.2020
Epoch 6/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  8.00it/s, loss=6.4814, ppl=652.88]
<> Validating...

<> Epoch 6 Results:
<>  Time: 0:02:08
Train Loss: 6.2542 | Train PPL: 520.20
Valid Loss: 6.1348 | Valid PPL: 461.63
<> Saved new best model with validation loss: 6.1348
Epoch 7/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:12<00:00,  7.60it/s, loss=6.4478, ppl=631.31]
<> Validating...

<> Epoch 7 Results:
<>  Time: 0:02:15
Train Loss: 6.1533 | Train PPL: 470.28
Valid Loss: 6.0768 | Valid PPL: 435.65
<> Saved new best model with validation loss: 6.0768
Epoch 8/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [01:55<00:00,  8.72it/s, loss=6.4316, ppl=621.14]
<> Validating...

<> Epoch 8 Results:
<>  Time: 0:01:58
Train Loss: 6.0669 | Train PPL: 431.32
Valid Loss: 6.0292 | Valid PPL: 415.38
<> Saved new best model with validation loss: 6.0292
Epoch 9/30: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:12<00:00,  7.59it/s, loss=6.3823, ppl=591.30]
<> Validating...

<> Epoch 9 Results:
<>  Time: 0:02:15
Train Loss: 5.9919 | Train PPL: 400.17
Valid Loss: 5.9898 | Valid PPL: 399.33
<> Saved new best model with validation loss: 5.9898
Epoch 10/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:11<00:00,  7.62it/s, loss=6.3915, ppl=596.73]
<> Validating...

<> Epoch 10 Results:
<>  Time: 0:02:15
Train Loss: 5.9274 | Train PPL: 375.19
Valid Loss: 5.9533 | Valid PPL: 385.03
<> Saved new best model with validation loss: 5.9533
Epoch 11/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  8.01it/s, loss=6.3719, ppl=585.16]
<> Validating...

<> Epoch 11 Results:
<>  Time: 0:02:08
Train Loss: 5.8713 | Train PPL: 354.69
Valid Loss: 5.9323 | Valid PPL: 377.03
<> Saved new best model with validation loss: 5.9323
Epoch 12/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:23<00:00,  7.00it/s, loss=6.3600, ppl=578.22]
<> Validating...

<> Epoch 12 Results:
<>  Time: 0:02:26
Train Loss: 5.8199 | Train PPL: 336.93
Valid Loss: 5.9091 | Valid PPL: 368.38
<> Saved new best model with validation loss: 5.9091
Epoch 13/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:11<00:00,  7.65it/s, loss=6.3178, ppl=554.35]
<> Validating...

<> Epoch 13 Results:
<>  Time: 0:02:14
Train Loss: 5.7726 | Train PPL: 321.38
Valid Loss: 5.8904 | Valid PPL: 361.56
<> Saved new best model with validation loss: 5.8904
Epoch 14/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:06<00:00,  7.93it/s, loss=6.3237, ppl=557.66]
<> Validating...

<> Epoch 14 Results:
<>  Time: 0:02:10
Train Loss: 5.7310 | Train PPL: 308.28
Valid Loss: 5.8728 | Valid PPL: 355.23
<> Saved new best model with validation loss: 5.8728
Epoch 15/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:08<00:00,  7.84it/s, loss=6.3367, ppl=564.94]
<> Validating...

<> Epoch 15 Results:
<>  Time: 0:02:11
Train Loss: 5.6930 | Train PPL: 296.77
Valid Loss: 5.8552 | Valid PPL: 349.06
<> Saved new best model with validation loss: 5.8552
Epoch 16/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:06<00:00,  7.94it/s, loss=6.3137, ppl=552.10]
<> Validating...

<> Epoch 16 Results:
<>  Time: 0:02:09
Train Loss: 5.6580 | Train PPL: 286.58
Valid Loss: 5.8394 | Valid PPL: 343.59
<> Saved new best model with validation loss: 5.8394
Epoch 17/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:07<00:00,  7.90it/s, loss=6.3107, ppl=550.42]
<> Validating...

<> Epoch 17 Results:
<>  Time: 0:02:10
Train Loss: 5.6261 | Train PPL: 277.57
Valid Loss: 5.8176 | Valid PPL: 336.16
<> Saved new best model with validation loss: 5.8176
Epoch 18/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:07<00:00,  7.90it/s, loss=6.3058, ppl=547.72]
<> Validating...

<> Epoch 18 Results:
<>  Time: 0:02:10
Train Loss: 5.5991 | Train PPL: 270.18
Valid Loss: 5.8044 | Valid PPL: 331.75
<> Saved new best model with validation loss: 5.8044
Epoch 19/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:06<00:00,  7.92it/s, loss=6.2957, ppl=542.24]
<> Validating...

<> Epoch 19 Results:
<>  Time: 0:02:10
Train Loss: 5.5747 | Train PPL: 263.68
Valid Loss: 5.7956 | Valid PPL: 328.86
<> Saved new best model with validation loss: 5.7956
Epoch 20/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:06<00:00,  7.95it/s, loss=6.2641, ppl=525.36]
<> Validating...

<> Epoch 20 Results:
<>  Time: 0:02:09
Train Loss: 5.5535 | Train PPL: 258.13
Valid Loss: 5.7895 | Valid PPL: 326.85
<> Saved new best model with validation loss: 5.7895
Epoch 21/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:09<00:00,  7.79it/s, loss=6.2655, ppl=526.10]
<> Validating...

<> Epoch 21 Results:
<>  Time: 0:02:12
Train Loss: 5.5351 | Train PPL: 253.42
Valid Loss: 5.7800 | Valid PPL: 323.75
<> Saved new best model with validation loss: 5.7800
Epoch 22/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  7.98it/s, loss=6.2332, ppl=509.38]
<> Validating...

<> Epoch 22 Results:
<>  Time: 0:02:09
Train Loss: 5.5195 | Train PPL: 249.52
Valid Loss: 5.7747 | Valid PPL: 322.05
<> Saved new best model with validation loss: 5.7747
Epoch 23/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:04<00:00,  8.06it/s, loss=6.2623, ppl=524.43]
<> Validating...

<> Epoch 23 Results:
<>  Time: 0:02:07
Train Loss: 5.5076 | Train PPL: 246.56
Valid Loss: 5.7698 | Valid PPL: 320.48
<> Saved new best model with validation loss: 5.7698
Epoch 24/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  7.98it/s, loss=6.2633, ppl=524.94]
<> Validating...

<> Epoch 24 Results:
<>  Time: 0:02:09
Train Loss: 5.5011 | Train PPL: 244.97
Valid Loss: 5.7656 | Valid PPL: 319.13
<> Saved new best model with validation loss: 5.7656
Epoch 25/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  7.99it/s, loss=6.2536, ppl=519.87]
<> Validating...

<> Epoch 25 Results:
<>  Time: 0:02:09
Train Loss: 5.4995 | Train PPL: 244.57
Valid Loss: 5.7619 | Valid PPL: 317.95
<> Saved new best model with validation loss: 5.7619
Epoch 26/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  7.98it/s, loss=6.2238, ppl=504.62]
<> Validating...

<> Epoch 26 Results:
<>  Time: 0:02:09
Train Loss: 5.5006 | Train PPL: 244.84
Valid Loss: 5.7568 | Valid PPL: 316.32
<> Saved new best model with validation loss: 5.7568
Epoch 27/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  8.02it/s, loss=6.2056, ppl=495.52]
<> Validating...

<> Epoch 27 Results:
<>  Time: 0:02:08
Train Loss: 5.4989 | Train PPL: 244.42
Valid Loss: 5.7499 | Valid PPL: 314.15
<> Saved new best model with validation loss: 5.7499
Epoch 28/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:05<00:00,  8.03it/s, loss=6.2324, ppl=508.97]
<> Validating...

<> Epoch 28 Results:
<>  Time: 0:02:08
Train Loss: 5.4942 | Train PPL: 243.28
Valid Loss: 5.7455 | Valid PPL: 312.78
<> Saved new best model with validation loss: 5.7455
Epoch 29/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:04<00:00,  8.07it/s, loss=6.2030, ppl=494.22]
<> Validating...

<> Epoch 29 Results:
<>  Time: 0:02:07
Train Loss: 5.4884 | Train PPL: 241.87
Valid Loss: 5.7442 | Valid PPL: 312.36
<> Saved new best model with validation loss: 5.7442
Epoch 30/30: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████| 1005/1005 [02:12<00:00,  7.58it/s, loss=6.1911, ppl=488.40]
<> Validating...

<> Epoch 30 Results:
<>  Time: 0:02:15
Train Loss: 5.4858 | Train PPL: 241.24
Valid Loss: 5.7445 | Valid PPL: 312.47
<> No improvement for 1 epoch(s).

==================================================
<> Training Complete!
==================================================
Best validation loss: 5.7442
Total time: 1:07:00

<> Loading Best Model for Evaluation...

==================================================
<> FINAL TEST EVALUATION
==================================================
Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 118/118 [00:03<00:00, 31.32it/s]
>> Final Test Loss: 4.8596
>> Final Test Perplexity: 128.97
==================================================