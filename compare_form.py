import pandas as pd
import matplotlib.pyplot as plt

# ==========================================
# 1. Data Setup (Full 100 Epochs Data)
# ==========================================

# We keep the full data here, but we will SLICE it later for plotting
full_epochs = list(range(1, 101))

# Dummy example data (replace with your actual numbers)
# Each list should have the same length as epochs
#standard_transformer = {
#    "train_loss": [
#        8.2162,7.3298,7.1527,6.9992,6.8713,6.7736,6.6927,6.6257,6.5626,6.5032,
#        6.4449,6.3907,6.3385,6.29,6.2445,6.2032,6.1639,6.1317,6.0993,6.0645,
#        6.0323,6.0008,5.9711,5.9453,5.9181,5.8929,5.8759,5.8521,5.8275,5.8016,
#        5.7814,5.7595,5.7387,5.7155,5.6947,5.6735,5.6533,5.6331,5.6149,5.5976,
#        5.5796,5.5631,5.5462,5.5323,5.5199,5.5088,5.4951,5.4826,5.4668,5.4525,
#        5.44,5.4287,5.4169,5.4073,5.399,5.3894,5.3794,5.3701,5.3615,5.3538,
#        5.3448,5.3353,5.3273,5.3204,5.3128,5.3065,5.2999,5.294,5.2895,5.284,
#        5.2789,5.2731,5.2685,5.2645,5.26,5.2559,5.2521,5.2491,5.2464,5.2437,
#        5.2404,5.2385,5.2371,5.2351,5.2338,5.2318,5.2305,5.2294,5.2279,5.2268,
#        5.226,5.2248,5.2238,5.2233,5.2229,5.2235,5.2231,5.2228,5.2226,5.2221
#    ],
#    "train_ppl": [
#        3700.59,1525.04,1277.51,1095.78,964.17,874.49,806.53,754.26,708.14,667.28,
#        629.47,596.25,565.97,539.13,515.19,494.34,475.29,460.21,445.57,430.3,
#        416.68,403.77,391.92,381.96,371.69,362.47,356.35,347.95,339.5,330.84,
#        324.21,317.19,310.67,303.54,297.28,291.05,285.23,279.54,274.48,269.78,
#        264.96,260.63,256.25,252.72,249.61,246.86,243.49,240.47,236.69,233.33,
#        230.45,227.85,225.18,223.03,221.18,219.07,216.9,214.89,213.04,211.42,
#        209.51,207.54,205.89,204.46,202.92,201.65,200.31,199.14,198.24,197.15,
#        196.16,195.01,194.12,193.35,192.48,191.69,190.96,190.39,189.89,189.37,
#        188.75,188.39,188.12,187.75,187.51,187.13,186.88,186.68,186.39,186.19,
#        186.05,185.82,185.64,185.55,185.47,185.58,185.51,185.45,185.42,185.33
#    ],
#    "valid_loss": [
#        7.1521,6.9636,6.8253,6.7013,6.6011,6.541,6.5008,6.4557,6.4133,6.3802,
#        6.3284,6.2867,6.2527,6.2232,6.19,6.1618,6.1387,6.1186,6.1004,6.0785,
#        6.0773,6.0589,6.0372,6.0233,6.0069,6.0011,5.9996,5.9848,5.9575,5.9425,
#        5.9363,5.9158,5.9124,5.9045,5.8953,5.8799,5.8748,5.8687,5.8635,5.8545,
#        5.8539,5.8473,5.8427,5.8363,5.827,5.8207,5.824,5.8169,5.8107,5.801,
#        5.7963,5.7937,5.7925,5.7972,5.7935,5.7889,5.7868,5.7821,5.7757,5.7711,
#        5.7713,5.767,5.7601,5.7593,5.7594,5.7594,5.7556,5.7517,5.751,5.7508,
#        5.7465,5.7442,5.7413,5.7384,5.7369,5.7363,5.7355,5.7349,5.7336,5.733,
#        5.7323,5.732,5.7318,5.7307,5.7292,5.7292,5.7282,5.728,5.7277,5.7273,
#        5.7271,5.7268,5.7267,5.7266,5.7264,5.7264,5.7263,5.7263,5.7263,5.7263
#    ],
#    "valid_ppl": [
#        1276.76,1057.45,920.85,813.43,735.89,693.01,665.67,636.33,609.89,590.02,
#        560.26,537.36,519.4,504.32,487.84,474.28,463.46,454.24,446.04,436.39,
#        435.87,427.91,418.71,412.96,406.24,403.89,403.28,397.36,386.64,380.89,
#        378.54,370.85,369.61,366.67,363.32,357.77,355.97,353.77,351.96,348.79,
#        348.6,346.29,344.7,342.51,339.34,337.22,338.31,335.94,333.85,330.64,
#        329.08,328.23,327.82,329.36,328.16,326.66,325.98,324.44,322.38,320.89,
#        320.95,319.59,317.39,317.14,317.15,317.16,315.96,314.72,314.49,314.44,
#        313.1,312.38,311.46,310.57,310.12,309.93,309.68,309.47,309.08,308.91,
#        308.69,308.6,308.54,308.19,307.72,307.74,307.42,307.37,307.25,307.13,
#        307.09,307,306.95,306.92,306.87,306.86,306.83,306.83,306.83,306.83
#    ],
#}

standard_transformer = {
    "train_loss": [
        8.7722, 7.6075, 7.3584, 7.2466, 7.1527, 7.0624, 6.979, 6.9022, 6.8335, 6.7764,
        6.7266, 6.6839, 6.6453, 6.6079, 6.5737, 6.5415, 6.5085, 6.4748, 6.4434, 6.4126,
        6.3829, 6.3539, 6.3308, 6.3115, 6.2873, 6.2639, 6.2408, 6.22, 6.197, 6.1752,
        6.1575, 6.1443, 6.1307, 6.1134, 6.0926, 6.0769, 6.0586, 6.0435, 6.0288, 6.0161,
        6.0035, 5.9918, 5.983, 5.9759, 5.9655, 5.9534, 5.9445, 5.933, 5.9206, 5.9074,
        5.8955, 5.8856, 5.8749, 5.8668, 5.8578, 5.8505, 5.8431, 5.8367, 5.8309, 5.8254,
        5.8162, 5.8088, 5.8026, 5.7967, 5.7915, 5.7858, 5.7814, 5.7774, 5.7723, 5.7687,
        5.7648, 5.7607, 5.7579, 5.7551, 5.752, 5.749, 5.7463, 5.7438, 5.7422, 5.7396,
        5.7377, 5.7358, 5.7342, 5.7328, 5.7315, 5.7295, 5.7286, 5.7276, 5.7273, 5.7264,
        5.7252, 5.7246, 5.7243, 5.7239, 5.7239, 5.7244, 5.7244, 5.7237, 5.7236, 5.7237
    ],
    "train_ppl": [
        6452.47, 2013.15, 1569.26, 1403.3, 1277.58, 1167.21, 1073.88, 994.42, 928.46, 876.87,
        834.31, 799.39, 769.13, 740.9, 716.04, 693.33, 670.83, 648.62, 628.51, 609.49,
        591.63, 574.73, 561.61, 550.89, 537.72, 525.25, 513.29, 502.69, 491.28, 480.69,
        472.27, 466.07, 459.74, 451.86, 442.58, 435.69, 427.76, 421.35, 415.2, 409.96,
        404.83, 400.12, 396.61, 393.82, 389.75, 385.08, 381.65, 377.29, 372.63, 367.75,
        363.38, 359.81, 355.98, 353.11, 349.95, 347.4, 344.85, 342.66, 340.67, 338.81,
        335.7, 333.23, 331.16, 329.2, 327.51, 325.63, 324.22, 322.92, 321.27, 320.11,
        318.86, 317.59, 316.67, 315.81, 314.81, 313.87, 313.02, 312.26, 311.75, 310.94,
        310.34, 309.76, 309.28, 308.83, 308.43, 307.81, 307.55, 307.22, 307.13, 306.87,
        306.48, 306.31, 306.22, 306.1, 306.09, 306.24, 306.26, 306.04, 306.0, 306.05
    ],
    "valid_loss": [
        7.614, 7.1515, 7.0334, 6.9426, 6.8637, 6.7867, 6.7218, 6.6545, 6.6033, 6.5693,
        6.5406, 6.5104, 6.4958, 6.4817, 6.4657, 6.4466, 6.4196, 6.3965, 6.3772, 6.3504,
        6.3334, 6.3179, 6.2966, 6.2943, 6.2777, 6.2595, 6.2376, 6.2309, 6.2116, 6.2039,
        6.1895, 6.1862, 6.1761, 6.1532, 6.1471, 6.1372, 6.1333, 6.1247, 6.1145, 6.1029,
        6.1021, 6.0994, 6.0946, 6.0862, 6.0838, 6.0681, 6.0733, 6.0584, 6.0552, 6.0461,
        6.0374, 6.0361, 6.0306, 6.0269, 6.0227, 6.0179, 6.0156, 6.0137, 6.0102, 6.0111,
        6.0084, 6.0034, 6.0026, 6.0012, 5.9988, 5.9969, 5.997, 5.9947, 5.9932, 5.991,
        5.9893, 5.9865, 5.9847, 5.9829, 5.9811, 5.9801, 5.9792, 5.9787, 5.9789, 5.9783,
        5.9781, 5.977, 5.9752, 5.974, 5.9737, 5.9731, 5.9725, 5.9726, 5.9721, 5.9719,
        5.9717, 5.9716, 5.9714, 5.9713, 5.9712, 5.9711, 5.9711, 5.9711, 5.9711, 5.9711
    ],
    "valid_ppl": [
        2026.31, 1276.07, 1133.85, 1035.51, 956.85, 886.03, 830.27, 776.28, 737.53, 712.88,
        692.68, 672.12, 662.38, 653.09, 642.72, 630.54, 613.73, 599.71, 588.27, 572.74,
        563.09, 554.41, 542.74, 541.49, 532.55, 522.94, 511.61, 508.19, 498.5, 494.7,
        487.62, 485.99, 481.11, 470.2, 467.37, 462.76, 460.97, 456.99, 452.37, 447.16,
        446.79, 445.58, 443.45, 439.75, 438.71, 431.84, 434.11, 427.67, 426.34, 422.46,
        418.79, 418.25, 415.98, 414.44, 412.7, 410.7, 409.79, 409.01, 407.58, 407.94,
        406.84, 404.79, 404.48, 403.9, 402.93, 402.17, 402.23, 401.32, 400.71, 399.8,
        399.14, 398.02, 397.29, 396.6, 395.87, 395.49, 395.12, 394.91, 395.0, 394.79,
        394.7, 394.24, 393.53, 393.06, 392.94, 392.71, 392.49, 392.54, 392.34, 392.23,
        392.19, 392.15, 392.06, 392.0, 391.98, 391.95, 391.94, 391.93, 391.93, 391.93
    ],
}

hierarchical_transformer_weighted_sum = {
    "train_loss": [
        23.6638,8.3151,7.4824,7.2377,7.0663,6.9228,6.8044,6.7048,6.6215,6.5595,
        6.5021,6.4449,6.394,6.3507,6.3132,6.2788,6.2415,6.2034,6.1684,6.1401,
        6.1098,6.0808,6.0521,6.023,5.992,5.9638,5.9392,5.9148,5.8888,5.8626,
        5.8452,5.8278,5.8117,5.79,5.7706,5.7583,5.739,5.7246,5.7113,5.6948,
        5.6787,5.6656,5.6486,5.6325,5.6193,5.6057,5.5912,5.5777,5.5629,5.551,
        5.5398,5.5302,5.5186,5.5089,5.5001,5.4911,5.4814,5.4721,5.4624,5.4551,
        5.4459,5.4384,5.4285,5.4212,5.4145,5.4059,5.3992,5.3944,5.3877,5.3817,
        5.3763,5.3717,5.3645,5.3581,5.3525,5.3474,5.3429,5.3382,5.3338,5.3292,
        5.3262,5.3224,5.3193,5.3167,5.3147,5.3112,5.3096,5.3073,5.3058,5.3048,
        5.3032,5.302,5.3,5.2995,5.2984,5.2971,5.2971,5.2966,5.2963,5.2964
    ],
    "train_ppl": [
        485165195.4,4084.96,1776.49,1390.83,1171.83,1015.18,901.8,816.31,751.03,705.9,
        666.52,629.49,598.24,572.87,551.78,533.12,513.6,494.41,477.43,464.11,
        450.26,437.36,424.99,412.83,400.22,389.09,379.63,370.47,360.97,351.63,
        345.58,339.63,334.19,327,320.73,316.81,310.74,306.31,302.27,297.33,
        292.56,288.76,283.89,279.36,275.71,271.98,268.07,264.48,260.57,257.49,
        254.63,252.19,249.28,246.88,244.73,242.52,240.17,237.96,235.66,233.95,
        231.82,230.06,227.8,226.15,224.63,222.71,221.23,220.16,218.69,217.4,
        216.21,215.23,213.69,212.32,211.13,210.07,209.12,208.14,207.22,206.28,
        205.65,204.87,204.24,203.72,203.3,202.58,202.27,201.81,201.5,201.3,
        200.99,200.74,200.35,200.23,200.02,199.76,199.75,199.65,199.6,199.61
    ],
    "valid_loss": [
        8.6563,7.2699,7.0405,6.8825,6.75,6.6357,6.5411,6.4687,6.4265,6.374,
        6.3244,6.2944,6.2739,6.2406,6.2198,6.2036,6.1785,6.1487,6.1286,6.1207,
        6.1024,6.0928,6.0649,6.051,6.0341,6.0366,6.0284,6.0149,5.9906,5.9822,
        5.9837,5.9763,5.9741,5.9568,5.9534,5.939,5.9431,5.9461,5.9287,5.9343,
        5.9293,5.913,5.9101,5.9087,5.896,5.9112,5.9012,5.8906,5.8884,5.8892,
        5.8811,5.8826,5.8803,5.8751,5.8677,5.8667,5.8649,5.8581,5.8611,5.8547,
        5.852,5.8615,5.8513,5.8583,5.8548,5.8496,5.8534,5.8494,5.8452,5.8502,
        5.8488,5.8408,5.8391,5.8369,5.8346,5.8293,5.8301,5.8307,5.8296,5.8286,
        5.828,5.8255,5.8259,5.825,5.8243,5.8229,5.8248,5.824,5.8229,5.8224,
        5.8215,5.8212,5.8206,5.8204,5.8204,5.8198,5.8195,5.8191,5.8191,5.8191
    ],
    "valid_ppl": [
        5745.99,1436.35,1141.91,975.05,854.06,761.82,693.05,644.61,618.01,586.39,
        558.02,541.55,530.55,513.16,502.62,494.52,482.25,468.13,458.81,455.2,
        446.94,442.65,430.49,424.53,417.41,418.46,415.04,409.47,399.67,396.3,
        396.91,393.96,393.1,386.36,385.08,379.54,381.11,382.25,375.68,377.76,
        375.89,369.83,368.75,368.21,363.57,369.16,365.48,361.61,360.82,361.13,
        358.2,358.74,357.93,356.07,353.45,353.07,352.44,350.04,351.1,348.89,
        347.92,351.24,347.69,350.12,348.9,347.09,348.43,347.02,345.59,347.29,
        346.83,344.06,343.47,342.7,341.94,340.12,340.39,340.59,340.23,339.88,
        339.69,338.82,338.95,338.67,338.43,337.96,338.6,338.33,337.94,337.79,
        337.49,337.37,337.16,337.1,337.12,336.9,336.8,336.68,336.67,336.66
    ],
}

hierarchical_transformer_C2P_P2C = {
    "train_loss": [
        8.1625,7.2883,7.0993,6.9359,6.8002,6.6942,6.615,6.5464,6.4869,6.4343,
        6.3838,6.3342,6.2819,6.2385,6.1918,6.1535,6.1189,6.0784,6.0413,6.0107,
        5.9889,5.965,5.9334,5.9136,5.8846,5.8581,5.8331,5.813,5.7907,5.7724,
        5.7605,5.7383,5.7178,5.6972,5.6824,5.6624,5.6429,5.6272,5.6137,5.5985,
        5.5842,5.5687,5.5556,5.5459,5.533,5.5188,5.507,5.4949,5.4845,5.4743,
        5.4678,5.4582,5.446,5.4387,5.4306,5.4236,5.413,5.4038,5.394,5.3854,
        5.3769,5.3664,5.358,5.3516,5.3454,5.3407,5.3354,5.3302,5.3254,5.3218,
        5.3187,5.315,5.3095,5.3053,5.3011,5.2971,5.2926,5.2894,5.2862,5.2835,
        5.2808,5.279,5.2766,5.2747,5.2739,5.2718,5.2709,5.2703,5.2694,5.2679,
        5.2673,5.2665,5.2656,5.2654,5.2645,5.2648,5.2647,5.2641,5.2644,5.264
    ],
    "train_ppl": [
        3506.97,1463.04,1211.14,1028.51,898.06,807.69,746.22,696.73,656.48,622.87,
        592.17,563.53,534.79,512.09,488.73,470.35,454.37,436.34,420.45,407.76,
        398.99,389.54,377.44,370.03,359.47,350.07,341.43,334.64,327.23,321.29,
        317.51,310.53,304.24,298.02,293.65,287.84,282.29,277.89,274.15,270.02,
        266.19,262.09,258.69,256.19,252.89,249.34,246.42,243.44,240.94,238.49,
        236.95,234.66,231.83,230.14,228.3,226.69,224.31,222.25,220.08,218.2,
        216.34,214.1,212.29,210.95,209.65,208.67,207.55,206.48,205.49,204.76,
        204.12,203.37,202.26,201.4,200.56,199.76,198.85,198.23,197.59,197.06,
        196.53,196.17,195.71,195.34,195.17,194.77,194.6,194.47,194.29,194.01,
        193.88,193.74,193.56,193.53,193.35,193.41,193.39,193.26,193.34,193.25
    ],
    "valid_loss": [
        7.1306,6.9259,6.7671,6.6453,6.5477,6.4778,6.4125,6.3755,6.335,6.2957,
        6.2594,6.2274,6.1909,6.1618,6.1358,6.1252,6.0996,6.0759,6.0557,6.058,
        6.0501,6.0372,6.0096,5.9812,5.9687,5.9583,5.9527,5.9463,5.9377,5.9209,
        5.9163,5.9137,5.9067,5.8818,5.8821,5.8667,5.8632,5.8618,5.8535,5.8477,
        5.8441,5.8352,5.8211,5.8241,5.8214,5.8129,5.8202,5.8174,5.8094,5.7981,
        5.808,5.7937,5.7924,5.7832,5.7836,5.7826,5.7743,5.7743,5.7686,5.7684,
        5.7657,5.7642,5.7624,5.7604,5.7581,5.7578,5.7579,5.759,5.7614,5.7628,
        5.7607,5.7553,5.7555,5.7523,5.7501,5.7483,5.7462,5.7444,5.7444,5.7436,
        5.7424,5.7425,5.7425,5.7427,5.7417,5.7413,5.741,5.7399,5.7399,5.7396,
        5.7393,5.7389,5.738,5.7379,5.7378,5.7377,5.7375,5.7376,5.7375,5.7375
    ],
    "valid_ppl": [
        1249.63,1018.36,868.81,769.16,697.61,650.55,609.42,587.28,563.97,542.26,
        522.9,506.46,488.27,474.3,462.13,457.26,445.68,435.24,426.56,427.54,
        424.16,418.72,407.3,395.92,391,386.93,384.8,382.34,379.06,372.74,
        371.04,370.07,367.47,358.44,358.58,353.07,351.84,351.37,348.46,346.43,
        345.2,342.14,337.34,338.37,337.45,334.58,337.03,336.09,333.42,329.68,
        332.97,328.24,327.79,324.8,324.93,324.59,321.93,321.93,320.09,320.01,
        319.15,318.68,318.1,317.46,316.74,316.65,316.69,317.04,317.8,318.23,
        317.57,315.87,315.92,314.92,314.21,313.66,312.99,312.43,312.43,312.19,
        311.81,311.84,311.85,311.92,311.58,311.46,311.37,311.04,311.04,310.95,
        310.86,310.73,310.45,310.41,310.37,310.36,310.3,310.31,310.3,310.3
    ],
}


#hierarchical_transformer_residual_y = {
#    "train_loss": [
#        8.1709, 7.2954, 7.0913, 6.9188, 6.7823, 6.6804, 6.6005, 6.5322, 6.4701, 6.4097,
#        6.3542, 6.3008, 6.2536, 6.2029, 6.1560, 6.1131, 6.0734, 6.0317, 5.9947, 5.9614,
#        5.9304, 5.9012, 5.8745, 5.8492, 5.8232, 5.7984, 5.7767, 5.7595, 5.7373, 5.7153,
#        5.6948, 5.6746, 5.6545, 5.6373, 5.6189, 5.5987, 5.5846, 5.5701, 5.5512, 5.5371,
#        5.5245, 5.5069, 5.4939, 5.4784, 5.4629, 5.4469, 5.4342, 5.4228, 5.4118, 5.3999,
#        5.3892, 5.3791, 5.3693, 5.3592, 5.3509, 5.3401, 5.3299, 5.3218, 5.3120, 5.3027,
#        5.2962, 5.2878, 5.2799, 5.2742, 5.2677, 5.2624, 5.2556, 5.2490, 5.2440, 5.2389,
#        5.2349, 5.2294, 5.2252, 5.2203, 5.2169, 5.2129, 5.2097, 5.2063, 5.2022, 5.2008,
#        5.1984, 5.1960, 5.1940, 5.1921, 5.1902, 5.1887, 5.1872, 5.1869, 5.1852, 5.1851,
#        5.1838, 5.1827, 5.1823, 5.1816, 5.1811, 5.1809, 5.1806, 5.1808, 5.1803, 5.1806
#    ],
#    "train_ppl": [
#        3536.35, 1473.56, 1201.45, 1011.12, 882.11, 796.60, 735.43, 686.91, 645.55, 607.74,
#        574.91, 544.99, 519.87, 494.16, 471.52, 451.73, 434.15, 416.44, 401.28, 388.14,
#        376.32, 365.47, 355.85, 346.97, 338.04, 329.76, 322.70, 317.20, 310.24, 303.47,
#        297.31, 291.36, 285.58, 280.71, 275.59, 270.08, 266.30, 262.45, 257.55, 253.94,
#        250.77, 246.39, 243.20, 239.45, 235.77, 232.04, 229.11, 226.51, 224.03, 221.39,
#        219.03, 216.83, 214.71, 212.55, 210.80, 208.54, 206.42, 204.76, 202.75, 200.87,
#        199.58, 197.90, 196.36, 195.24, 193.97, 192.94, 191.65, 190.37, 189.42, 188.46,
#        187.72, 186.69, 185.89, 185.00, 184.37, 183.62, 183.03, 182.42, 181.66, 181.41,
#        180.98, 180.54, 180.18, 179.85, 179.51, 179.24, 178.97, 178.91, 178.61, 178.59,
#        178.36, 178.17, 178.09, 177.98, 177.89, 177.84, 177.78, 177.83, 177.74, 177.79
#    ],
#    "valid_loss": [
#        7.1351, 6.9281, 6.7544, 6.6108, 6.5169, 6.4511, 6.4039, 6.3519, 6.3089, 6.2665,
#        6.2364, 6.1971, 6.1661, 6.1294, 6.1102, 6.0868, 6.0575, 6.0310, 6.0115, 5.9920,
#        5.9810, 5.9644, 5.9491, 5.9379, 5.9287, 5.9242, 5.9069, 5.9024, 5.8887, 5.8805,
#        5.8706, 5.8682, 5.8732, 5.8561, 5.8535, 5.8393, 5.8274, 5.8294, 5.8157, 5.8100,
#        5.8051, 5.7979, 5.7953, 5.7906, 5.7847, 5.7758, 5.7680, 5.7721, 5.7739, 5.7672,
#        5.7640, 5.7648, 5.7672, 5.7609, 5.7572, 5.7526, 5.7496, 5.7458, 5.7410, 5.7415,
#        5.7393, 5.7347, 5.7341, 5.7328, 5.7302, 5.7266, 5.7246, 5.7268, 5.7275, 5.7312,
#        5.7268, 5.7267, 5.7261, 5.7241, 5.7229, 5.7214, 5.7195, 5.7187, 5.7189, 5.7188,
#        5.7185, 5.7183, 5.7170, 5.7160, 5.7153, 5.7153, 5.7148, 5.7142, 5.7133, 5.7126,
#        5.7117, 5.7110, 5.7107, 5.7107, 5.7107, 5.7107, 5.7107, 5.7107, 5.7107, 5.7107
#    ],
#    "valid_ppl": [
#        1255.31, 1020.50, 857.79, 743.08, 676.46, 633.40, 604.21, 573.56, 549.46, 526.61,
#        511.01, 491.33, 476.30, 459.17, 450.44, 440.00, 427.32, 416.12, 408.11, 400.20,
#        395.85, 389.31, 383.40, 379.14, 375.68, 374.00, 367.56, 365.92, 360.92, 357.97,
#        354.45, 353.63, 355.40, 349.34, 348.46, 343.53, 339.47, 340.17, 335.52, 333.61,
#        332.00, 329.60, 328.74, 327.21, 325.27, 322.40, 319.90, 321.21, 321.79, 319.64,
#        318.61, 318.87, 319.63, 317.62, 316.46, 315.02, 314.07, 312.87, 311.37, 311.52,
#        310.85, 309.43, 309.22, 308.84, 308.03, 306.92, 306.30, 306.97, 307.20, 308.33,
#        306.98, 306.96, 306.77, 306.16, 305.80, 305.34, 304.76, 304.51, 304.57, 304.53,
#        304.46, 304.39, 303.98, 303.68, 303.47, 303.47, 303.33, 303.15, 302.86, 302.65,
#        302.38, 302.18, 302.08, 302.10, 302.07, 302.07, 302.09, 302.09, 302.09, 302.09
#    ]
#}

hierarchical_transformer_residual_y = {
    "train_loss": [
        8.7127, 7.5732, 7.3236, 7.2014, 7.0979, 6.9954, 6.8992, 6.8149, 6.7424, 6.6812,
        6.6283, 6.5827, 6.5458, 6.5119, 6.4706, 6.4363, 6.4026, 6.3711, 6.3393, 6.311,
        6.2818, 6.2526, 6.2202, 6.1911, 6.1655, 6.1406, 6.1152, 6.0902, 6.0698, 6.0483,
        6.0284, 6.0074, 5.9898, 5.9739, 5.9585, 5.946, 5.9353, 5.9223, 5.9027, 5.8904,
        5.8746, 5.8601, 5.8475, 5.8372, 5.8285, 5.8218, 5.8138, 5.7987, 5.7888, 5.7789,
        5.7708, 5.7585, 5.7488, 5.7415, 5.7347, 5.7305, 5.7231, 5.7119, 5.7067, 5.7012,
        5.6937, 5.6885, 5.6812, 5.6744, 5.6698, 5.6675, 5.662, 5.6553, 5.65, 5.6465,
        5.6423, 5.6386, 5.6348, 5.6321, 5.6296, 5.6262, 5.6233, 5.6211, 5.6184, 5.6166,
        5.6158, 5.6144, 5.613, 5.6111, 5.6098, 5.6087, 5.607, 5.6069, 5.6061, 5.605,
        5.6046, 5.6047, 5.6035, 5.6029, 5.6032, 5.6033, 5.6029, 5.6031, 5.6028, 5.6028
    ],
    "train_ppl": [
        6079.63, 1945.39, 1515.62, 1341.25, 1209.42, 1091.63, 991.52, 911.3, 847.58, 797.27,
        756.22, 722.49, 696.29, 673.12, 645.89, 624.09, 603.39, 584.68, 566.41, 550.61,
        534.77, 519.39, 502.79, 488.4, 476.04, 464.33, 452.69, 441.5, 432.6, 423.41,
        415.04, 406.42, 399.34, 393.04, 387.04, 382.24, 378.14, 373.28, 366.01, 361.56,
        355.88, 350.76, 346.36, 342.83, 339.84, 337.57, 334.88, 329.88, 326.62, 323.4,
        320.8, 316.88, 313.81, 311.53, 309.42, 308.13, 305.86, 302.44, 300.88, 299.22,
        296.98, 295.46, 293.31, 291.31, 289.97, 289.32, 287.73, 285.8, 284.3, 283.3,
        282.1, 281.06, 280, 279.24, 278.54, 277.61, 276.79, 276.18, 275.46, 274.95,
        274.74, 274.34, 273.98, 273.43, 273.09, 272.79, 272.34, 272.3, 272.07, 271.79,
        271.68, 271.7, 271.38, 271.22, 271.31, 271.31, 271.2, 271.27, 271.19, 271.19
    ],
    "valid_loss": [
        7.568, 7.1224, 7.0024, 6.9164, 6.8152, 6.7172, 6.6402, 6.5847, 6.523, 6.481,
        6.4444, 6.414, 6.4051, 6.3637, 6.3373, 6.3129, 6.2869, 6.2695, 6.2427, 6.2234,
        6.2015, 6.1912, 6.1629, 6.1488, 6.1363, 6.1194, 6.107, 6.0965, 6.0887, 6.0744,
        6.0566, 6.0472, 6.0386, 6.0282, 6.0196, 6.0069, 6.0028, 5.9863, 5.9806, 5.9743,
        5.9691, 5.9644, 5.9597, 5.9591, 5.9601, 5.9533, 5.9525, 5.9475, 5.941, 5.9342,
        5.9241, 5.9183, 5.9146, 5.9143, 5.9151, 5.9158, 5.9056, 5.9043, 5.9045, 5.8981,
        5.9002, 5.8947, 5.8879, 5.8826, 5.8765, 5.8692, 5.8684, 5.8684, 5.867, 5.8647,
        5.8629, 5.8626, 5.8614, 5.8592, 5.8582, 5.8573, 5.8572, 5.8565, 5.856, 5.8558,
        5.8549, 5.8526, 5.8516, 5.8509, 5.8509, 5.8511, 5.8504, 5.8491, 5.8492, 5.8488,
        5.8489, 5.8486, 5.8488, 5.849, 5.8487, 5.8487, 5.8487, 5.8488, 5.8487, 5.8487
    ],
    "valid_ppl": [
        1935.26, 1239.44, 1099.29, 1008.65, 911.61, 826.51, 765.23, 723.93, 680.59, 652.6,
        629.17, 610.33, 604.91, 580.39, 565.25, 551.64, 537.49, 528.24, 514.22, 504.4,
        493.48, 488.42, 474.82, 468.18, 462.33, 454.58, 449.01, 444.28, 440.86, 434.59,
        426.92, 422.94, 419.3, 414.97, 411.41, 406.24, 404.57, 397.92, 395.67, 393.18,
        391.16, 389.3, 387.48, 387.25, 387.64, 385.02, 384.7, 382.8, 380.3, 377.74,
        373.95, 371.79, 370.42, 370.28, 370.61, 370.84, 367.08, 366.61, 366.68, 364.35,
        365.1, 363.12, 360.66, 358.75, 356.57, 353.96, 353.69, 353.68, 353.2, 352.39,
        351.75, 351.62, 351.23, 350.45, 350.08, 349.79, 349.74, 349.5, 349.33, 349.25,
        348.95, 348.16, 347.78, 347.55, 347.55, 347.62, 347.37, 346.93, 346.96, 346.81,
        346.86, 346.74, 346.83, 346.87, 346.78, 346.77, 346.77, 346.8, 346.8, 346.8
    ],
}



# ==========================================
# 2. Plotting Function
# ==========================================

# ==========================================
# 2. Filtering Function (Extract epochs 10-100)
# ==========================================

# Indices 9 to 100 correspond to Epochs 10 to 100
START_IDX = 9 
END_IDX = 100  

# Create the specific epoch range for the X-axis
epochs_slice = full_epochs[START_IDX:END_IDX]

def get_sliced_data(data_dict, key):
    return data_dict[key][START_IDX:END_IDX]

# ==========================================
# 3. Plotting Function
# ==========================================

#def plot_metric(metric_name, std_data, hier_data, weighted_data, residual_y_data):
def plot_metric(metric_name, std_data, residual_y_data):
    plt.figure(figsize=(10, 6))
    
    # Plotting lines using the SLICED data and SLICED epochs
    plt.plot(epochs_slice, std_data, label="Standard Transformer", color='blue', linestyle='-', linewidth=1.5)
    #plt.plot(epochs_slice, hier_data, label="Hierarchical Transformer (C2P-P2C)", color='green', linestyle='--', linewidth=1.5)
    #plt.plot(epochs_slice, weighted_data, label="Hierarchical Transformer (Weighted Sum)", color='orange', linestyle='-.', linewidth=1.5)
    plt.plot(epochs_slice, residual_y_data, label="Hierarchical Transformer (C2P-P2C with Residual Y)", color='red', linestyle=':', linewidth=2.0)
    
    plt.xlabel("Epoch")
    plt.ylabel(metric_name)
    plt.title(f"{metric_name} vs Epoch (Epochs 10-100)")
    plt.legend()
    plt.grid(True, linestyle='--', alpha=0.7)
    
    # Since we are filtering the massive spike, we might NOT need log scale anymore,
    # but let's keep it optional or just linear if the values are close.
    # For 10-90 range, values are much closer, so linear scale often works better to see small differences.
    # However, if you still want log scale for PPL, uncomment the next two lines:
    if "PPL" in metric_name:
        plt.yscale('log')
        
    plt.tight_layout()
    plt.show()

# ==========================================
# 4. Generate the Four Plots (Sliced 10-90)
# ==========================================

# 1. Train Loss
plot_metric("Train Loss",
            get_sliced_data(standard_transformer, "train_loss"),
            #get_sliced_data(hierarchical_transformer_C2P_P2C, "train_loss"),
            #get_sliced_data(hierarchical_transformer_weighted_sum, "train_loss"),
            get_sliced_data(hierarchical_transformer_residual_y, "train_loss"))

# 2. Train PPL 
plot_metric("Train PPL",
            get_sliced_data(standard_transformer, "train_ppl"),
            #get_sliced_data(hierarchical_transformer_C2P_P2C, "train_ppl"),
            #get_sliced_data(hierarchical_transformer_weighted_sum, "train_ppl"),
            get_sliced_data(hierarchical_transformer_residual_y, "train_ppl"))

# 3. Valid Loss
plot_metric("Valid Loss",
            get_sliced_data(standard_transformer, "valid_loss"),
            #get_sliced_data(hierarchical_transformer_C2P_P2C, "valid_loss"),
            #get_sliced_data(hierarchical_transformer_weighted_sum, "valid_loss"),
            get_sliced_data(hierarchical_transformer_residual_y, "valid_loss"))

# 4. Valid PPL 
plot_metric("Valid PPL",
            get_sliced_data(standard_transformer, "valid_ppl"),
            #get_sliced_data(hierarchical_transformer_C2P_P2C, "valid_ppl"),
            #get_sliced_data(hierarchical_transformer_weighted_sum, "valid_ppl"),
            get_sliced_data(hierarchical_transformer_residual_y, "valid_ppl"))
